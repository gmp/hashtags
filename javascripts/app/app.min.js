/*! hashtags 2013-07-15 */
var ht={Routes:{},Templates:{},Views:{},Models:{},Collections:{},Data:{},Helpers:{},init:function(){this.dispatcher=_.extend({},Backbone.Events),this.app=new this.Views.AppView,this.router=new this.Routes.Router,Backbone.history.start(),$("body").append(this.app.$el)}};ht.Helpers.getMyPlayer=function(a,b){return a.get("players")[b]},ht.Helpers.delegateCustomEvents=function(a,b,c){for(var d in b){var e=b[d];if(_.isFunction(e)||(e=c[b[d]]),!e)throw new Error('Method "'+b[d]+'" does not exist');e=_.bind(e,c),a.on(d,e)}},ht.Helpers.scrollTop=function(){window.scrollTo(0,1)},Backbone.Model.prototype.unsetChanges=function(){_(this.changed).each(function(a,b){this.unset(b,{silent:!0})},this)},Backbone.View.prototype.doubleTap=function(a){for(var b in a)ht.dispatcher.off(b);this.remove.apply(this,arguments)},ht.Templates.CreateGameSearchTemplate=_.template('<div class="row"><div class="small-11 small-centered columns"><input type="text" id="playerSearch" placeholder="Search for friends" autofocus="autofocus" autocomplete="off"><ul class="no-bullet namesList" id="nameSearchDropDown"></ul></div></div>'),ht.Templates.CreateGameTemplate=_.template('<div class="row"><div class="small-3 columns"><button id="cancel" class="small button">Cancel</button></div><div class="small-9 columns"><h3>#CreateNewGame</h2></div></div><form id="game-title-form" onsubmit="return false"><div class="row"><div class="small-2 columns"><label for="right-label" class="right inline">#Title</label></div><div class="small-10 columns"><input type="text" name="gameTitle" id="right-label" placeholder="eg. Super Awesome Game Title"></div></div></form><ul class="small-block-grid-2 text-center"><li><img id="player1" class="avatar" src=" <%= avatarURL %> "></li><li><img id="player2" class="avatar avatar-contain" src="images/placeholder.jpg"></li><li><img id="player3" class="avatar avatar-contain" src="images/placeholder.jpg"></li><li><img id="player4" class="avatar avatar-contain" src="images/placeholder.jpg"></li></ul><div class="row"><div id="startGameButton" class="small-6 small-centered columns"><button id="start">Start The Game!</button></div></div>'),ht.Templates.GameEndTemplate=_.template('<div class="game-header row text-center fixed"><div class="small-11 small-centered columns"><h6><%= prompt %><h6><p id="winner">Winner: <%= winner %></p></div></div><div class="row text-center"><div class="small-11 small-centered columns"><table><thead><tr><% _.each(playersWithScore, function(player) { %><th><%= player.username %></th><% }); %></tr></thead><tbody><tr><% _.each(playersWithScore, function(player) { %><td><%= player.score %></td><% }); %></tr></tbody></table></div></div><% _.each(players, function(player) { %><div class="row text-center"><div class="small-11 small-centered columns"><% if(player.username === myPlayer.username) { %><h4>You submitted:</h4><% } else { %><h4><%= player.username %> submitted:</h4><% } %><div class="text-left"><% if(player.username === winner) { %><span class="ribbon">Winner!</span><% } %><% if(player.submission.type === "image") { %><img class="media" src="<%= player.submission.url %>"><% } else { %><video class="media" src="<%= player.submission.url %>"></video><% } %></div><h4>#<%= player.submission.hashtag %></h4></div></div><% }); %><div class="row"><div class="small-9 small-centered columns"><button class="expand success" id="continue">Continue</button></div></div><div class="row"><div class="small-9 small-centered columns"><a href="/#lobby/<%= myPlayer.userGlobalId %>" class="button expand">Back to lobby</a></div></div>'),ht.Templates.GameHeaderTemplate=_.template('<div class="small-11 small-centered columns"><h6><%= prompt %></h6></div><div class="row"><div class="small-11 small-centered columns"><p>Judge: <%= judge.username %></p></div></div>'),ht.Templates.GameTemplate=_.template('<div class="game-header"></div><div class="play-or-judge"></div>'),ht.Templates.GameWaitingTemplate=_.template('<% _.each(players, function(player) { %><% if(player.submitted) { %><div class="row text-center"><div class="small-11 small-centered columns"><% if(player.submission.type === "image") { %><h4><%= player.username %> submitted:</h4><img class="media" src="<%= player.submission.url %>"><h4>#<%= player.submission.hashtag %></h4><% } else { %><h4>#<%= player.username %> submitted:</h4><video class="media" src="<%= player.submission.url %>"></video><h4><%= player.submission.hashtag %></h4><% } %></div></div><% } %><% }); %>'),ht.Templates.JudgeTemplate=_.template('<div><h4>You\'re the judge<h4></div><% if(remainingSubs) { %><h4>Awaiting <%= remainingSubs %> submissions</h4><% } else { %><h4>Ready to vote!</h4><% } %><% _.each(players, function(player) { %><% if(player.submitted) { %><div class="row text-center"><div class="small-11 small-centered columns"><h4>#<%= player.submission.hashtag %></h4><% if(player.submission.type === "image") { %><img class="media" src="<%= player.submission.url %>"><% if(remainingSubs) { %><button class="media-select expand disabled" data-submittedby="<%= player.username %>" data-submittedUrl="<%= player.submission.url %>">Choose Image</button><% } else { %><button class="media-select expand" data-submittedby="<%= player.username %>" data-submittedUrl="<%= player.submission.url %>">Choose Image</button><% } %><% } else { %><video class="media" src="<%= player.submission.url %>"></video><% if(remainingSubs) { %><button class="media-select expand disabled" data-submittedby="<%= player.username %>" data-submittedUrl="<%= player.submission.url %>">Choose Video</button><% } else { %><button class="media-select expand" data-submittedby="<%= player.username %>" data-submittedUrl="<%= player.submission.url %>">Choose Video</button><% } %><% } %></div></div><% } %><% }); %><div class="row"><div class="small-9 small-centered columns"><a href="/#lobby/<%= myPlayer.userGlobalId %>" class="button expand">Back to lobby</a></div></div>'),ht.Templates.LobbyGamesListTemplate=_.template('<div class="section-container accordian" data-section="accordian"><% for(var i = 0; i < games.length; i++) { %><section><p class="title game" data-section-title><i class="icon-reorder menu-icon"></i> | <%= games[i].title %></p><div class="content" data-section-content><ul class="no-bullet"><li><b>Prompt:</b> <%= games[i].prompt %></li><li><b>Judge:</b> <%= games[i].judge.username %></li><li><b>Players:</b></li><ul class="inline-list"><% for(var j = 0; j < games[i].players.length; j++) { %><li><%= games[i].players[j].username %><span><%= games[i].players[j].score %></span></li><% } %></ul><li><a class="button small expand" href="/#game/<%= games[i].gameId %>">Play!</a></li></ul></div></section><% } %></div>'),ht.Templates.LobbyInvitesTemplate=_.template('<% for(var i = 0; i < invites.length; i++) { %><div class="small-10 small-centered columns invite"><p><b><%=invites[i].author %></b> has invited you to play!</p><div class="row"><div class="small-6 columns"><button class="accept small" data-invite-id="<%=invites[i].invite %>">Accept</button></div><div class="small-6 columns"><button class="decline small" data-invite-id="<%=invites[i].invite %>">Decline</button></div></div></div><% } %>'),ht.Templates.LobbyPendingGamesTemplate=_.template('<div class="section-container accordian" data-section="accordian"><% for(var i = 0; i < pendingGames.length; i++) { %><section><% if (pendingGames[i].declined) { %><p class="title pending game strike" data-section-title>Pending game: <%= pendingGames[i].title %></p><% } else { %><p class="title pending game" data-section-title>Pending game: <%= pendingGames[i].title %></p><% } %><div class="content" data-section-content><% if (pendingGames[i].declined) { %><p class="red">Ugh! One of your stupid friends decided not to play.</p><button class="declined small expand" id="<%=pendingGames[i]._id%>">Remove game</button><% } else { %><p>Hang tight. <br>We\'re waiting on some more friends to join.</p><% } %></div></section><% } %></div>'),ht.Templates.LobbyTemplate=_.template('<div class="row lobby-header"><div class="small-3 columns"><img src="<%= avatarURL %>"></div><div class="small-7 columns"><h2>#Lobby</h2></div><div class="small-2 columns"><button data-modal-id="new-game-modal" id="new-game-button" class="small button newGame">+</button><br></div></div><% if (games.length === 0 && invites.length === 0 && pendingGames.length === 0) { %><div class="row noGames"><div class="small-10 small-centered columns"><p>You have no games!<br><br>Click here <br><button data-modal-id="new-game-modal" id="new-game-button" class="small button newGame">+</button><br>to get started</p></div></div><% } %><div id="new-game-modal" class="new-game-modal"><div class="small-centered columns"><button class="small" id="start-new-game">Start a new game</button><br><button class="small" id="join-random">Join a random game</button><br><button class="small" id="cancel">Cancel</button></div></div>'),ht.Templates.LoginTemplate=_.template('<div class="row"><div class="small-8 small-centered columns"><h1>#</h1><h3>Hashtags for All Mankind</h3><a href="/auth/instagram" class="instagram-login"></a></div></div>'),ht.Templates.PlayerHashtagSelectTemplate=_.template('<% for(var i = 0; i < hand.length; i++) { %><div class="row"><div class="small-10 small-centered columns"><button class="hashtag radius expand" data-hashtag="<%= hand[i] %>" >#<%= hand[i] %></button></div></div></div><% } %>'),ht.Templates.PlayerImageSelectTemplate=_.template('<div class="row text-center"><div class="small-9 small-centered columns"><h3> #<%= hashtag %> </h3></div></div>'),ht.Templates.PlayerWaitingTemplate=_.template('<% _.each(players, function(player) { %><% if(player.submitted) { %><div class="row text-center"><div class="small-11 small-centered columns"><% if(player.username === myPlayer.username) { %><h4>You submitted:</h4><% } else { %><h4><%= player.username %> submitted:</h4><% } %><% if(player.submission.type === "image") { %><img class="media" src="<%= player.submission.url %>"><h4>#<%= player.submission.hashtag %></h4><% } else { %><video class="media" src="<%= player.submission.url %>"></video><h4>#<%= player.submission.hashtag %></h4><% } %></div></div><% } %><% }); %><div class="row"><div class="small-9 small-centered columns"><a href="/#lobby/<%= myPlayer.userGlobalId %>" class="button expand">Back to lobby</a></div></div>'),ht.Routes.Router=Backbone.Router.extend({routes:{"":"checkState",login:"login",error:"error","lobby/:id":"lobby","lobby/:id/new":"createGame","game/:gameId":"game"},initialize:function(){},checkState:function(){this.navigate("/login",{trigger:!0})},back:function(){window.history.back()},login:function(){ht.app.login()},error:function(){ht.app.error()},lobby:function(a){ht.app.lobby(a)},createGame:function(){ht.app.createGame()},game:function(a){ht.app.game(a)}}),ht.Models.GameModel=Backbone.Model.extend({urlRoot:"/games"}),ht.Models.UserModel=Backbone.Model.extend({urlRoot:"/users"}),ht.Collections.GamesColl=Backbone.Collection.extend({}),ht.Collections.UsersColl=Backbone.Collection.extend({url:"/users",model:ht.Models.UserModel}),ht.Views.AppView=Backbone.View.extend({id:"#hashtags",initialize:function(){this.createSockets(),ht.Helpers.delegateCustomEvents(ht.dispatcher,this.dispatcher_events,this),this.render()},render:function(){return this},dispatcher_events:{joinGame:"joinGame",leaveRooms:"leaveRooms"},socket_events:{changeInUser:"changeInUser",joinedRoom:"joinedRoom",otherPlayerSubmit:"otherPlayerSubmit",judgeSelect:"judgeSelect"},createSockets:function(){this.socket=io.connect(),this.socket_events&&_.size(this.socket_events)>0&&ht.Helpers.delegateCustomEvents(this.socket,this.socket_events,this)},leaveRooms:function(){this.roomId&&(this.socket.emit("leaveGame",this.roomId),delete this.roomId)},changeInUser:function(){ht.dispatcher.trigger("changeInUser")},joinGame:function(a){this.socket.emit("joinGame",a)},joinedRoom:function(a){this.roomId=a},login:function(){this.$el.empty(),this.$el.append((new ht.Views.LoginView).el)},error:function(){this.$el.empty(),this.$el.append((new ht.Views.ErrorView).el)},lobby:function(a){var b=this;this.socket.emit("gotUserId",{user:a}),this.currentGame&&this.currentGame.remove(),this.user=this.user||new ht.Models.UserModel({id:a}),this.user.fetch({success:function(a){b.$el.empty(),b.$el.append(new ht.Views.LobbyView({model:a}).el)},error:function(a,b){console.log("error: ",b)}})},createGame:function(){this.$el.empty(),this.$el.append(new ht.Views.CreateGameView({model:this.user}).el)},game:function(a){if(this.user){var b=this,c=new ht.Models.GameModel({id:a});c.fetch({success:function(a){b.$el.empty(),b.currentGame=new ht.Views.GameView({model:a,attributes:{user:b.user}}),b.$el.append(b.currentGame.el)},error:function(a,b){console.log("error: ",b)}})}else ht.router.navigate("/login",{trigger:!0})},otherPlayerSubmit:function(){ht.dispatcher.trigger("playerSubmit")},judgeSelect:function(){ht.dispatcher.trigger("judgeSelect")}}),ht.Views.CreateGameSearchView=Backbone.View.extend({className:"search",template:ht.Templates.CreateGameSearchTemplate,initialize:function(){this.render()},events:{"keyup #playerSearch":"autosearch","click .name":"search"},render:function(){var a=this.autosearch();this.$el.append(this.template({names:a}))},autosearch:function(){var a=$("#playerSearch").val();b&&clearTimeout("times");var b=setTimeout(function(){$.ajax({url:"users/searching/"+a,type:"GET",success:function(a){$("#nameSearchDropDown").empty(),a.length&&(console.log(a),_.each(a,function(a){$("#nameSearchDropDown").append('<li class="name" data-username="'+a.username+'"><img class="avatar-supersmall" src="'+a.avatarURL+'">'+a.username+"</li>")}))}})},750)},search:function(a){var b=this,c=$(a.target).data("username");$.ajax({url:"/users/search/"+c,type:"GET",success:function(a){ht.dispatcher.trigger("addInvited",a,b.attributes.player)},error:function(){console.log("error")}})}}),ht.Views.CreateGameView=Backbone.View.extend({className:"create-game",template:ht.Templates.CreateGameTemplate,searchVisible:!1,initialize:function(){ht.Helpers.delegateCustomEvents(ht.dispatcher,this.dispatcher_events,this),this.render()},events:{"keypress input[name=gameTitle]":"removeError","click #cancel":"cancel","click .avatar-contain":"searchStart","click #start":"sendInvitations"},dispatcher_events:{addInvited:"addInvited"},render:function(){this.$el.empty(),this.$el.append(this.template(this.model.attributes))},cancel:function(){this.doubleTap(this.dispatcher_events),ht.router.back()},removeError:function(){this.gameTitle&&this.gameTitle.hasClass("error")&&($("#invalid").remove(),this.gameTitle.removeClass("error"))},sendInvitations:function(){if(this.gameTitle=$("input[name=gameTitle]"),!this.gameTitle.val())return this.gameTitle.after('<small id="invalid" class="error">Please add a game title</small>'),this.gameTitle.addClass("error");$("#startGameButton").hide();var a=this,b={};b.author=this.model.get("username"),b.gameAdmin={user:this.model.get("_id"),username:this.model.get("username"),avatarURL:this.model.get("avatarURL")},b.player2={user:this.player2._id,username:this.player2.username,avatarURL:this.player2.avatarURL,accepted:"waiting"},b.player3={user:this.player3._id,username:this.player3.username,avatarURL:this.player3.avatarURL,accepted:"waiting"},b.player4={user:this.player4._id,username:this.player4.username,avatarURL:this.player4.avatarURL,accepted:"waiting"},b.title=this.gameTitle.val(),$.ajax({url:"/invite/create",type:"POST",data:b,success:function(){a.doubleTap(this.dispatcher_events),ht.router.navigate("/lobby/"+a.model.get("_id"),{trigger:!0})},error:function(a,b,c){console.log(c)}})},addInvited:function(a,b){this.searchView.remove(),this.searchVisible=!1,this[b]=a,$("#"+b).attr("src",a.avatarURL),this.player2&&this.player3&&this.player4&&$("#startGameButton").show()},searchStart:function(a){this.searchVisible?(this.searchView.remove(),this.searchVisible=!1):(this.searchView=new ht.Views.CreateGameSearchView({attributes:{player:a.target.id}}),this.searchVisible=!0,this.$el.find("#game-title-form").after(this.searchView.el))}}),ht.Views.ErrorView=Backbone.View.extend({className:"error",initialize:function(){this.render()},render:function(){this.$el.empty(),this.$el.html('<p>There was a login error</p><p>Please try again:<br><a href="/auth/instagram" class="instagram-login"></a></p>')}}),ht.Views.GameEndView=Backbone.View.extend({className:"gameEnd",template:ht.Templates.GameEndTemplate,initialize:function(){this.render()},events:{"click #continue":"goToNextRound","click video":"playVideo"},render:function(){ht.Helpers.scrollTop(),this.$el.empty(),this.$el.append(this.template({playersWithScore:this.model.get("players"),players:this.model.get("previousRound").players,myPlayer:this.attributes.myPlayer,winner:this.model.get("previousRound").winner,prompt:this.model.get("previousRound").prompt}))},goToNextRound:function(){var a=this,b=this.model.get("players"),c=b[this.attributes.myPlayer.userGlobalId];c.continued=!0,this.model.set("players",b),this.model.save(c,{patch:!0,success:function(){a.model.unsetChanges(),ht.dispatcher.trigger("continued")}})},playVideo:function(a){a.target.play()}}),ht.Views.GameHeaderView=Backbone.View.extend({className:"game-header row fixed",template:ht.Templates.GameHeaderTemplate,initialize:function(){this.render()},render:function(){this.$el.append(this.template(this.model.attributes))}}),ht.Views.GameView=Backbone.View.extend({className:"gameView",initialize:function(){ht.Helpers.delegateCustomEvents(ht.dispatcher,this.dispatcher_events,this),this.myPlayer=ht.Helpers.getMyPlayer(this.model,this.attributes.user.id),this.joinGame(),this.render()},dispatcher_events:{mediaSelect:"mediaSelect",judgeSelect:"judgeSelect",continued:"continued"},render:function(){ht.Helpers.scrollTop(),this.$el.empty(),this.myPlayer.continued?(this.$el.append(new ht.Views.GameHeaderView({model:this.model}).el),this.myPlayer.isJ?(this.subView&&this.subView.doubleTap(this.subView.dispatcher_events),this.subView=new ht.Views.JudgeView({model:this.model,attributes:{myPlayer:this.myPlayer}}),this.$el.append(this.subView.el)):(this.subView&&this.subView.doubleTap(this.subView.dispatcher_events),this.subView=new ht.Views.PlayerView({model:this.model,attributes:{user:this.attributes.user,myPlayer:this.myPlayer}}),this.$el.append(this.subView.el))):(this.subView&&this.subView.doubleTap(this.subView.dispatcher_events),this.subView=new ht.Views.GameEndView({model:this.model,attributes:{myPlayer:this.myPlayer}}),this.$el.append(this.subView.el))},joinGame:function(){ht.dispatcher.trigger("joinGame",this.model.get("id"))},mediaSelect:function(){var a=this;this.model.fetch({success:function(){a.subView.doubleTap(this.dispatcher_events)},error:function(){console.log("error")}})},judgeSelect:function(){var a=this;this.model.fetch({success:function(){a.myPlayer=ht.Helpers.getMyPlayer(a.model,a.attributes.user.id),a.render()}})},continued:function(){this.myPlayer=ht.Helpers.getMyPlayer(this.model,this.attributes.user.id),this.render()}}),ht.Views.JudgeView=Backbone.View.extend({className:"judge",template:ht.Templates.JudgeTemplate,initialize:function(){ht.Helpers.delegateCustomEvents(ht.dispatcher,this.dispatcher_events,this),this.render()},events:{"click .media-select":"judgeChoose","click video":"playVideo"},dispatcher_events:{playerSubmit:"playerSubmit"},render:function(){ht.Helpers.scrollTop(),this.$el.empty();var a=0,b=this.model.get("players");_.each(b,function(b){b.submitted&&a++});var c=Object.keys(b).length-1-a;this.$el.append(this.template({players:this.model.get("players"),myPlayer:this.attributes.myPlayer,remainingSubs:c}))},playerSubmit:function(){var a=this;this.model.fetch({success:function(){a.render()},error:function(){console.error("error")}})},judgeChoose:function(a){var b=0,c=this.model.get("players");if(_.each(c,function(a){a.submitted&&b++}),b===Object.keys(c).length-1){var d={};d.winningSub=$(a.target).data("submittedUrl"),d.winner=$(a.target).data("submittedby");var e=this;d.players=[],_.each(c,function(a){a.isJ||d.players.push({username:a.username,submission:a.submission})}),d.prompt=this.model.get("prompt"),this.model.set("previousRound",d),this.attributes.myPlayer.continued=!1,this.model.save(d,{success:function(){e.doubletap(this.dispatcher_events),ht.dispatcher.trigger("judgeSelect")},error:function(){console.error("bummer dude. save failed.")}})}},playVideo:function(a){a.target.play()}}),ht.Views.LobbyGamesListView=Backbone.View.extend({className:"games-list",template:ht.Templates.LobbyGamesListTemplate,initialize:function(){this.render()},render:function(){this.$el.empty(),this.$el.append(this.template({games:this.model.get("games")}))}}),ht.Views.LobbyInvitesView=Backbone.View.extend({className:"invites row",template:ht.Templates.LobbyInvitesTemplate,events:{"click .accept":"inviteResponse","click .decline":"declineResponse"},initialize:function(){this.render()},render:function(){this.$el.empty(),this.$el.append(this.template({invites:this.model.get("invites")})),this.model.on("change:invites",this.render,this)},inviteResponse:function(a){var b=$(a.target).data("invite-id"),c={inviteId:b,userId:this.model.id},d=this;$.ajax({url:"/invites/accept/",type:"POST",data:c,success:function(){console.log("post success"),d.model.fetch()},error:function(){console.log("error")}})},declineResponse:function(a){var b=$(a.target).data("invite-id"),c={inviteId:b,userId:this.model.id},d=this;$.ajax({url:"/invites/decline/",type:"POST",data:c,success:function(){console.log("post success"),d.model.fetch()},error:function(){console.log("error")}})}}),ht.Views.LobbyPendingGamesView=Backbone.View.extend({className:"pending-games-list",template:ht.Templates.LobbyPendingGamesTemplate,initialize:function(){this.render()},events:{"click .declined":"removeGame"},render:function(){this.$el.empty(),this.$el.append(this.template({pendingGames:this.model.get("pendingGames")}))},removeGame:function(a){var b=this,c={userId:this.model.attributes.id,pendingGameId:a.target.id};$.ajax({url:"/invites/removeDeclinedGame",type:"POST",data:c,success:function(){b.model.fetch()},error:function(){console.log("error")}})}}),ht.Views.LobbyView=Backbone.View.extend({className:"lobby",template:ht.Templates.LobbyTemplate,initialize:function(){ht.Helpers.scrollTop(),ht.Helpers.delegateCustomEvents(ht.dispatcher,this.dispatcher_events,this),this.model.on("change:pendingGames",this.render,this),this.model.on("change:invites",this.render,this),this.leaveRooms(),this.render()},events:{"click #new-game-button":"modalShow","click #cancel, #mask":"modalHide","click #start-new-game":"createGame","click #join-random":"joinrandom"},dispatcher_events:{changeInUser:"changeInUser"},render:function(){ht.Helpers.scrollTop(),this.$el.empty(),this.$el.append(this.template(this.model.attributes)),this.model.get("invites").length&&(this.invites=new ht.Views.LobbyInvitesView({model:this.model}),this.$el.append(this.invites.el)),this.model.get("pendingGames").length&&(this.pendingGames=new ht.Views.LobbyPendingGamesView({model:this.model}),this.$el.append(this.pendingGames.el)),this.model.get("games").length&&(this.games=new ht.Views.LobbyGamesListView({model:this.model}),this.$el.append(this.games.el))},leaveRooms:function(){ht.dispatcher.trigger("leaveRooms")},modalShow:function(){$("#new-game-modal").fadeIn(300),this.$el.append('<div id="mask" class="mask"></div>'),$("#mask").fadeIn(300)},modalHide:function(){$("#mask, #new-game-modal, #invite-game-modal").fadeOut(300,function(){$("#mask").remove()})},changeInUser:function(){var a=this;this.model.fetch({success:function(){a.render()},error:function(a,b){console.log("error: ",b)}})},createGame:function(){this.modalHide(),ht.router.navigate("/lobby/"+this.model.id+"/new",{trigger:!0})},joinrandom:function(){this.modalHide();var a=this;$.ajax({url:"/random/"+this.model.id,type:"GET",success:function(){a.model.fetch({success:function(){a.render()}})},error:function(){console.log("error")}})}}),ht.Views.LoginView=Backbone.View.extend({className:"login",template:ht.Templates.LoginTemplate,initialize:function(){this.render()},render:function(){this.$el.empty(),this.$el.append(this.template())}}),ht.Views.PlayerHashtagSelectView=Backbone.View.extend({template:ht.Templates.PlayerHashtagSelectTemplate,initialize:function(){this.render()},events:{"click .hashtag":"hashtagClick"},render:function(){ht.Helpers.scrollTop(),this.$el.append(this.template({hand:this.attributes.hand}))},hashtagClick:function(a){this.remove(),ht.dispatcher.trigger("hashtagClick",$(a.target).data("hashtag"))}}),ht.Views.PlayerImageSelectView=Backbone.View.extend({className:"image-select",template:ht.Templates.PlayerImageSelectTemplate,initialize:function(){this.getMedia(),this.render()},events:{"click .media-select":"submitMedia","click video":"playVideo","click #tryAgain":"getMedia"},render:function(){ht.Helpers.scrollTop(),this.$el.empty(),this.$el.append(this.template({hashtag:this.attributes.hashtag}))},getMedia:function(){var a=this,b=this.attributes.hashtag,c=this.attributes.accessToken;$.ajax({url:"https://api.instagram.com/v1/tags/"+b+"/media/recent?access_token="+c,dataType:"jsonp",success:function(b){console.log("get images response",b),a.addMedia(b.data)},error:function(b){console.log("get images error:",b),a.$el.append('<div class="text-center media-container row"><div class="small-11 small-centered columns"><p>Woops! There was an error getting imagges.<br>Please try again</p><button class="expand" id="tryAgain">C\'mon Instagram, gimme some images!</button></div></div>')}})},addMedia:function(a){for(var b="",c=0,d=a.length;d>c;c++)if("image"===a[c].type){var e=a[c];b+='<div class="text-center media-container row"><div class="small-11 small-centered columns"><img class="media" src="'+e.images.low_resolution.url+'">'+'<button data-type ="'+e.type+'" data-url="'+e.images.low_resolution.url+'" class="media-select expand">Submit Image</button>'+"</div>"+"</div>"}else if("video"===a[c].type){var f=a[c];b+='<div class="text-center media-container row"><div class="small-11 small-centered columns"><video class="media" src="'+f.videos.low_resolution.url+'"></video>'+'<button data-type ="'+f.type+'" data-url="'+f.videos.low_resolution.url+'" class="media-select expand">Submit Video</button>'+"</div>"+"</div>"}this.$el.append(b)},submitMedia:function(a){var b=this,c=$(a.target).data("url"),d=$(a.target).data("type"),e=this.attributes.hashtag,f=this.model.get("players"),g=f[this.attributes.myPlayer.userGlobalId];g.submitted=!0,g.submission={url:c,type:d,hashtag:e},this.model.set("players",f),this.model.save(g,{patch:!0,success:function(a){b.model.unsetChanges(),ht.dispatcher.trigger("mediaSelect",a),b.remove()},error:function(){console.error("bummer dude")}})},playVideo:function(a){a.target.play()}}),ht.Views.PlayerView=Backbone.View.extend({className:"player",initialize:function(){ht.Helpers.delegateCustomEvents(ht.dispatcher,this.dispatcher_events,this),this.subView=void 0,this.hashtagSelected=!1,this.render()},dispatcher_events:{hashtagClick:"hashtagClick"},render:function(){ht.Helpers.scrollTop(),this.attributes.myPlayer=ht.Helpers.getMyPlayer(this.model,this.attributes.user.id),this.attributes.myPlayer.submitted||this.hashtagSelected?!this.attributes.myPlayer.submitted&&this.hashtagSelected?(this.subView&&this.subView.remove(),this.$el.empty(),this.subView=new ht.Views.PlayerImageSelectView({model:this.model,attributes:{myPlayer:this.attributes.myPlayer,accessToken:this.attributes.user.get("accessToken"),hashtag:this.hashtagSelected}}),this.$el.append(this.subView.el)):this.attributes.myPlayer.submitted&&(this.subView&&this.subView.remove(),this.$el.empty(),this.subView=new ht.Views.PlayerWaitingView({model:this.model,attributes:{myPlayer:this.attributes.myPlayer}}),this.$el.append(this.subView.el)):(this.subView&&this.subView.remove(),this.$el.empty(),this.subView=new ht.Views.PlayerHashtagSelectView({model:this.model,attributes:{hand:this.attributes.myPlayer.hand}}),this.$el.append(this.subView.el))},hashtagClick:function(a){this.hashtagSelected=a,this.render(),console.log("hashtagClick")}}),ht.Views.PlayerWaitingView=Backbone.View.extend({className:"waiting",template:ht.Templates.PlayerWaitingTemplate,initialize:function(){ht.Helpers.delegateCustomEvents(ht.dispatcher,this.dispatcher_events,this),this.render()},dispatcher_events:{playerSubmit:"playerSubmit"},events:{"click video":"playVideo"},render:function(){ht.Helpers.scrollTop(),this.$el.empty(),this.$el.append(this.template({players:this.model.get("players"),myPlayer:this.attributes.myPlayer}))},playerSubmit:function(){var a=this;this.model.fetch({success:function(){a.render()},error:function(){console.error("error")}})},playVideo:function(a){a.target.play()}});